<!DOCTYPE html><html lang="en"><?php include_once("util/LogUtil.php"); ?><?php include_once("util/DBUtil.php"); ?><?php include_once("delegate/ProjectDelegate.php"); ?><?php include_once("util/WebUtil.php"); ?><?php include_once("mobile_detect/Mobile_Detect.php");?><?php	$webUtil = new WebUtil ();	$webUtil->srcPage = "edit_category.php";// 	set_error_handler ( array (// 			$webUtil,// 			'handleError' // 	) );		$detect = new Mobile_Detect ();	$isMobile = ($detect->isMobile() && !$detect->isTablet());	$isTablet = $detect->isTablet();		$currentUser = $webUtil->getLoggedInUser();	if(!$currentUser->hasRole('admin'))	{		header ( "Location: select_qa.php" );		exit ();	}		//$categoryDAO->saveReport($category);	$projectDelegate = new ProjectDelegate();	$projectID = intval($_GET ["projectID"]);	$categoryID = intval($_GET ["categoryID"]);	$categoryOptions = $projectDelegate->getCategoryOptions($projectID, $categoryID);	$categoryOptionsMissing = $projectDelegate->getCategoryOptionsNotInReport($projectID, $categoryID);		$project = $projectDelegate->getProject($projectID);	$category = $projectDelegate->getCategory($projectID,$categoryID);	$editCategories = true;	$deleteCategories = true;	$message = "";	if (isset ( $_GET ["message"] )) 	{		$message = $_GET ["message"];	}	?><head><meta charset="utf-8"><link rel="icon" type="image/png" href="img/favicon-32x32.png" sizes="32x32" /><title>Dinomo QA</title><meta name="viewport"	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><script src="js/jquery-1.7.2.min.js"></script><script src="js/jquery-1.7.2-ui.min.js"></script><script src="js/bootstrap.js"></script><script src="js/base.js"></script><link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="css/jquery-ui.css" rel="stylesheet" type="text/css" /><link href="css/bootstrap-responsive.min.css" rel="stylesheet"	type="text/css" /><link rel="stylesheet" type="text/css" href="css/dinamo.css"><link href="css/font-awesome.css" rel="stylesheet"><link	href="css/google-fonts.css"	rel="stylesheet"><link href="css/style.css" rel="stylesheet" type="text/css"><link href="css/pages/signin.css" rel="stylesheet" type="text/css"><link href="sortable/css/application.css" rel="stylesheet" type="text/css"><style>body.dragging, body.dragging * {  cursor: move !important;}.dragged {  position: absolute;  opacity: 0.5;  z-index: 2000;}ol.example li.placeholder {  position: relative;  /** More li styles **/}ol.example li.placeholder:before {  position: absolute;  /** Define arrowhead **/}input.text-view{	font-style:italic;	width:100px;	padding-left:10px;	margin-top:5px;	height:10px;	margin-left:10px}td.label-span{	font-weight:bold;	padding-top:10px;}td.value-span{	padding-top:10px;}</style></head><body><script src='sortable/js/jquery-sortable.js'></script>			<div class="span4">              <ol class="simple_with_animation vertical" id="currElementsDiv" style="height:600px;overflow-y:scroll;" >				<?php 				$idx = 0;				while ( $categoryOption = $categoryOptions->iterate () )				{						$idx++;					$divID = "cat_div_".$idx;					$liID = $idx;				?>				<?php 					if ($categoryOption->formType == 'TEXT' || $categoryOption->formType == 'TEXTAREA') 					{				?>	                <li id="<?=$liID?>"><?=$categoryOption->title?><br/><span style="float:left"><a href="#" style="color:green;text-decoration:underline;"  id="<?=$divID?>_view" onclick="viewDiv('<?=$divID?>')">View</a><a href="#" style="color:red;text-decoration:underline;display:none" id="<?=$divID?>_close" onclick="closeDiv('<?=$divID?>')">Close</a>&nbsp;&nbsp;<a href="#" style="color:orange;text-decoration:underline;" id="<?=$liID?>_edit" onclick="editTextDiv('<?=$liID?>')">Edit</a></span><br/>	                <div style="background:white;display:none;padding-top:5px;" id="div_<?=$divID?>">	                	<span style="font-weight: bold"><?=$categoryOption->title?>:</span><span><input type="text" readonly class="text-view" value="some text"/></span>	            	</div>		 		<?php					}					else if ($categoryOption->formType == 'RADIO') 					{				?>	                <li id="<?=$liID?>"><?=$categoryOption->title?><br/><span style="float:left"><a href="#" style="color:green;text-decoration:underline;"  id="<?=$divID?>_view" onclick="viewDiv('<?=$divID?>')">View</a><a href="#" style="color:red;text-decoration:underline;display:none" id="<?=$divID?>_close" onclick="closeDiv('<?=$divID?>')">Close</a>&nbsp;&nbsp;<a href="#" style="color:orange;text-decoration:underline;" id="<?=$liID?>_edit" onclick="editDiv('<?=$liID?>')">Edit</a></span><br/>	                <div style="background:white;display:none;padding-top:5px;" id="div_<?=$divID?>">	                	<span style="font-weight: bold"><?=$categoryOption->title?>:</span><br/>		 		<?php	 	   $radioOptions = $categoryOption->getSetting("radioOptions");	 	   if(!empty($radioOptions))	 	   {		 	   	foreach ( $radioOptions as $radioOption )	 		   	{	 		   		?>         				<span> <input type="radio" disabled value="<?=$radioOption["radioOption"]?>"><?=$radioOption["radioOptionTitle"];?></span><br/>	          		<?php				}	 	   }				?>	 	   	            	</div>		 		<?php					}else{						            	?>                <li id="<?=$liID?>"><?=$categoryOption->title?><br/><span style="float:left"><a href="#" style="color:green;text-decoration:underline;"  id="<?=$divID?>_view" onclick="viewDiv('<?=$divID?>')">View</a><a href="#" style="color:red;text-decoration:underline;display:none" id="<?=$divID?>_close" onclick="closeDiv('<?=$divID?>')">Close</a>&nbsp;&nbsp;<a href="#" style="color:orange;text-decoration:underline;" id="<?=$liID?>_edit" onclick="editDiv('<?=$liID?>')">Edit</a></span><br/>		 		<?php					}	            	?>            						</li>				<?php 				}				?>              </ol>			</div>            			<div class="span4" style="height:600px;overflow-y:scroll;" >              <ol class="simple_with_animation vertical" id="availableElementsDiv" >				<?php 				while ( $categoryOption = $categoryOptionsMissing->iterate () )				{						$idx++;					$divID = "cat_div_".$idx;					$liID = $idx;				?>                <li class="highlight" id="<?=$liID?>"><?=$categoryOption->title?><br/><span style="float:left"><a href="#" style="color:green;text-decoration:underline;"  id="<?=$divID?>_view" onclick="viewDiv('<?=$divID?>')">View</a><a href="#" style="color:red;text-decoration:underline;display:none" id="<?=$divID?>_close" onclick="closeDiv('<?=$divID?>')">Close</a>&nbsp;&nbsp;<a href="#" style="color:orange;text-decoration:underline;display:none" id="<?=$liID?>_edit" onclick="editDiv('<?=$liID?>')">Edit</a></span><br/>				<?php 					if ($categoryOption->formType == 'TEXT' || $categoryOption->formType == 'TEXTAREA') 					{				?>	                <div style="background:white;display:none;padding-top:5px;" id="div_<?=$divID?>">	                	<span style="font-weight: bold"><?=$categoryOption->title?>:</span><span><input type="text" readonly class="text-view" value="some text"/></span>	            	</div>		 		<?php					}					if ($categoryOption->formType == 'RADIO') 					{				?>	                <div style="background:white;display:none;padding-top:5px;" id="div_<?=$divID?>">	                	<span style="font-weight: bold"><?=$categoryOption->title?>:</span><br/>		 		<?php	 	   $radioOptions = $categoryOption->getSetting("radioOptions");	 	   if(!empty($radioOptions))	 	   {		 	   	foreach ( $radioOptions as $radioOption )	 		   	{	 		   		?>         				<span> <input type="radio" disabled value="<?=$radioOption["radioOption"]?>"><?=$radioOption["radioOptionTitle"];?></span><br/>	          		<?php				}	 	   }				?>	 	   	            	</div>		 		<?php					}            	?>					</li>				<?php 				}				?>				</ol>            </div>                        			<div class="modal" style="display: none" id="loader" name="loader">				<div class="center">					<img alt="" src="img/loader.gif" />				</div>			</div>		<div id="dialog-confirm" style="display:none" title="Empty the recycle bin?">		  <p><span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 20px 0;"></span>These items will be permanently deleted and cannot be recovered. Are you sure?</p>		</div>		<div id="dialog-text" style="display:none" title="Edit Field">			<table>				<tr>					<td class="label-span"><span>Label</span></td>					<td class="value-span"><input type="text" id="dialog-text-title-value"/></td>				</tr>				<tr>					<td class="label-span"><span>Type</span></td>					<td class="value-span">				  <input type="radio" name="dialog-text-type" value="standard">Standard Text (1 line) 				  <input type="radio" name="dialog-text-type" value="long">Large Text (Multple lines/Paragraph)  					</td>				</tr>				<tr>					<td class="label-span"><span>Is Required</span></td>					<td class="value-span">				  <input type="radio" name="dialog-text-required" value="1">Yes 				  <input type="radio" name="dialog-text-required" value="0">No  					</td>				</tr>				<tr>					<td class="label-span"><span>Apply Changes</span></td>					<td class="value-span">				  <input type="radio" name="dialog-text-required" value="1">Yes 				  <input type="radio" name="dialog-text-required" value="0">No  					</td>				</tr>				</table>		</div></body><script>$(function  () {	  $("ol.example").sortable();	});var adjustment;$("ol.simple_with_animation").sortable({  group: 'simple_with_animation',  pullPlaceholder: false,  // animation on drop  onDrop: function  ($item, container, _super) {    var $clonedItem = $('<li/>').css({height: 0});    $item.before($clonedItem);    $clonedItem.animate({'height': $item.height()});	//alert(JSON.stringify($item));    $item.animate($clonedItem.position(), function  () {      $clonedItem.detach();      _super($item, container);    });    loadCurrElements();  },  // set $item relative to cursor position  onDragStart: function ($item, container, _super) {    var offset = $item.offset(),        pointer = container.rootGroup.pointer;    adjustment = {      left: pointer.left - offset.left,      top: pointer.top - offset.top    };    _super($item, container);  },  onDrag: function ($item, position) {    $item.css({      left: position.left - adjustment.left,      top: position.top - adjustment.top    });  }});var selectedField;function closeDiv(id){	document.getElementById('div_'+id).style.display='none';	document.getElementById(id+"_close").style.display='none';	document.getElementById(id+"_view").style.display='';}function editDiv(id){	try{	    $( "#dialog-confirm" ).dialog('open');		//$('#'+id).simulate("drag", {dragTarget: $("#availableElementsDiv")});	   }catch(e){			alert(e.message);		}	//document.getElementById('div_'+id).style.display='none';}function editTextDiv(id){	selectedField = id;	try{	    $( "#dialog-text" ).dialog('open');		//$('#'+id).simulate("drag", {dragTarget: $("#availableElementsDiv")});	   }catch(e){			alert(e.message);		}	//document.getElementById('div_'+id).style.display='none';}function viewDiv(id){	document.getElementById('div_'+id).style.display='';	document.getElementById(id+"_view").style.display='none';	document.getElementById(id+"_close").style.display='';}function CategoryOption(id,title,formType,optionSettings,isRequired) {	this.id=id;	this.title=title;	this.formType=formType;	this.optionSettings=optionSettings;	this.isRequired=isRequired;}var currElements = [];   var availableElements = [];   var allElements = [];   function addCurrElement(categoryOption){	currElements.push(categoryOption);}function addAvailableElement(categoryOption){	availableElements.push(categoryOption);}function addAllElement(idx,categoryOption){	allElements[idx] = categoryOption;}function loadCurrElements(){	//var ids = "";	currElements = [];	$('#currElementsDiv').children('li').each(function () {	    //alert(this.value); // "this" is the current element in the loop	    if(this.id && this.id != '' && !isNaN(this.id))	    {		    //ids+=this.id+"\n";		    id = parseInt(this.id);	    	currElements.push(allElements[id]);	    	document.getElementById(id+"_edit").style.display='';	    }	});		$('#availableElementsDiv').children('li').each(function () {	    //alert(this.value); // "this" is the current element in the loop	    if(this.id && this.id != '' && !isNaN(this.id))	    {		    //ids+=this.id+"\n";		    id = parseInt(this.id);	    	document.getElementById(id+"_edit").style.display='none';	    }	});		/*	text = '';	for (var i=0;i < currElements.length; i++) 	{    	text += currElements[i].title+"\n";	}	alert(text);	*/}<?php 		$idx = 0;		while ( $categoryOption = $categoryOptions->iterate () )		{				$idx++;			$json = json_encode($categoryOption->optionSettings);			$jsonOptionSettings = str_replace("'","\'",$json);			$title = str_replace("'","\'",$categoryOption->title);					?>addCurrElement(new CategoryOption(<?=$idx?>,'<?=$title?>','<?=$categoryOption->formType?>','<?=$jsonOptionSettings?>',<?=$categoryOption->isRequired?>));addAllElement(<?=$idx?>,new CategoryOption(<?=$idx?>,'<?=$title?>','<?=$categoryOption->formType?>','<?=$jsonOptionSettings?>',<?=$categoryOption->isRequired?>));		<?php		}		while ( $categoryOption = $categoryOptionsMissing->iterate () )		{			$idx++;			$json = json_encode($categoryOption->optionSettings);			$jsonOptionSettings = str_replace("'","\'",$json);			$title = str_replace("'","\'",$categoryOption->title);			echo "\n";				?>addAvailableElement(new CategoryOption(<?=$idx?>,'<?=$title?>','<?=$categoryOption->formType?>','<?=$jsonOptionSettings?>',<?=$categoryOption->isRequired?>));addAllElement(<?=$idx?>,new CategoryOption(<?=$idx?>,'<?=$title?>','<?=$categoryOption->formType?>','<?=$jsonOptionSettings?>',<?=$categoryOption->isRequired?>));		<?php		}		$idx++;		?>var nextElement = <?=$idx?>;	$(function () {	    $( "#dialog-confirm" ).dialog({        resizable: false,        height: "auto",        width: 400,        modal: true,        autoOpen: false,        buttons: {          "Delete all items": function() {            $( this ).dialog( "close" );          },          Cancel: function() {            $( this ).dialog( "close" );          }        }      });	    $( "#dialog-text" ).dialog({        resizable: false,        height: "auto",        width: 600,        modal: true,        autoOpen: false,        buttons: {          "Save": function() {            $( this ).dialog( "close" );          },          Cancel: function() {            $( this ).dialog( "close" );          }        }      });});</script></html>